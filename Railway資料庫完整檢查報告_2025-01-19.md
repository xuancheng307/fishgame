# Railway è³‡æ–™åº«å®Œæ•´æª¢æŸ¥å ±å‘Š

**æª¢æŸ¥æ—¥æœŸ**: 2025-01-19
**è³‡æ–™åº«**: Railway MySQL (hopper.proxy.rlwy.net:17950/fishmarket_game)
**ç‹€æ…‹**: âœ… å®Œæ•´ä¸”æ­£ç¢º

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

Railway è³‡æ–™åº«çµæ§‹å·²å®Œå…¨ç¬¦åˆå¾Œç«¯ä»£ç¢¼çš„è¦æ±‚ï¼š

âœ… **æ‰€æœ‰ 8 å€‹è³‡æ–™è¡¨å­˜åœ¨ä¸”çµæ§‹æ­£ç¢º**
âœ… **games è¡¨å·²è£œé½Šæ‰€æœ‰ç¼ºå°‘çš„æ¬„ä½ï¼ˆå…±æ·»åŠ  12 å€‹æ¬„ä½ï¼‰**
âœ… **å…¶ä»–è¡¨çµæ§‹èˆ‡å¾Œç«¯ä»£ç¢¼å®Œå…¨åŒ¹é…**
âœ… **å¯ä»¥å®‰å…¨éƒ¨ç½²æ›´æ–°å¾Œçš„å¾Œç«¯ä»£ç¢¼**

---

## ğŸ—„ï¸ è³‡æ–™è¡¨æ¸…å–®

| # | è¡¨åç¨± | æ¬„ä½æ•¸ | è³‡æ–™ç­†æ•¸ | ç‹€æ…‹ |
|---|--------|--------|----------|------|
| 1 | users | 8 | 13 | âœ… å®Œæ•´ |
| 2 | games | 26 | 1 | âœ… å®Œæ•´ï¼ˆå·²è£œé½Šï¼‰ |
| 3 | game_days | 15 | 0 | âœ… å®Œæ•´ |
| 4 | game_participants | 14 | 0 | âœ… å®Œæ•´ |
| 5 | bids | 12 | 0 | âœ… å®Œæ•´ |
| 6 | transactions | 11 | 0 | âœ… å®Œæ•´ |
| 7 | daily_results | 23 | 0 | âœ… å®Œæ•´ |
| 8 | game_logs | 8 | 0 | âœ… å®Œæ•´ |

---

## ğŸ”§ æœ¬æ¬¡åŸ·è¡Œçš„ä¿®æ­£

### ç¬¬ä¸€éšæ®µï¼šæ·»åŠ  force-end å’Œ team_names æ¬„ä½

æ·»åŠ åˆ° `games` è¡¨ï¼š
- âœ… `team_names` (json) - éšŠä¼è‡ªè¨‚åç¨±æ˜ å°„
- âœ… `is_force_ended` (tinyint) - å¼·åˆ¶çµæŸæ¨™è¨˜
- âœ… `force_ended_at` (timestamp) - å¼·åˆ¶çµæŸæ™‚é–“æˆ³
- âœ… `force_end_day` (int) - å¼·åˆ¶çµæŸå¤©æ•¸

### ç¬¬äºŒéšæ®µï¼šè£œé½Š games è¡¨æ‰€æœ‰æ¨™æº–æ¬„ä½

æ·»åŠ åˆ° `games` è¡¨ï¼š
- âœ… `num_teams` (int) - åƒèˆ‡éšŠä¼æ•¸é‡
- âœ… `loan_interest_rate` (decimal) - è²¸æ¬¾åˆ©ç‡ï¼ˆå…¼å®¹æ¬„ä½ï¼‰
- âœ… `distributor_floor_price_a` (decimal) - Aç´šé­šç¸½ä»£ç†åº•åƒ¹
- âœ… `distributor_floor_price_b` (decimal) - Bç´šé­šç¸½ä»£ç†åº•åƒ¹
- âœ… `target_price_a` (decimal) - Aç´šé­šç›®æ¨™åƒ¹æ ¼
- âœ… `target_price_b` (decimal) - Bç´šé­šç›®æ¨™åƒ¹æ ¼
- âœ… `buying_duration` (int) - è²·å…¥éšæ®µæ™‚é–“ï¼ˆåˆ†é˜ï¼‰
- âœ… `selling_duration` (int) - è³£å‡ºéšæ®µæ™‚é–“ï¼ˆåˆ†é˜ï¼‰

**ç¸½è¨ˆ**: å¾ 14 å€‹æ¬„ä½æ“´å……åˆ° 26 å€‹æ¬„ä½

---

## ğŸ“Š games è¡¨å®Œæ•´çµæ§‹

```sql
CREATE TABLE `games` (
  -- åŸºæœ¬è³‡è¨Š
  `id` int NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `name` varchar(100) NOT NULL,
  `description` text,

  -- éŠæˆ²ç‹€æ…‹
  `status` enum('pending','active','completed') NOT NULL DEFAULT 'pending',
  `phase` enum('waiting','buying','selling','settling','day_ended') DEFAULT 'waiting',

  -- éŠæˆ²åƒæ•¸
  `total_days` int NOT NULL DEFAULT 7,
  `current_day` int NOT NULL DEFAULT 0,
  `num_teams` int NOT NULL DEFAULT 10,             -- âœ… æ–°å¢
  `team_names` json DEFAULT NULL,                  -- âœ… æ–°å¢

  -- è²¡å‹™åƒæ•¸
  `initial_budget` decimal(12,2) NOT NULL DEFAULT 1000000.00,
  `daily_interest_rate` decimal(5,4) NOT NULL DEFAULT 0.0300,
  `loan_interest_rate` decimal(5,4) NOT NULL DEFAULT 0.0300,  -- âœ… æ–°å¢
  `max_loan_ratio` decimal(5,2) NOT NULL DEFAULT 0.50,

  -- å¸‚å ´åƒæ•¸
  `unsold_fee_per_kg` decimal(10,2) NOT NULL DEFAULT 10.00,  -- âœ… å·²ä¿®æ­£ç‚º 10.00
  `fixed_unsold_ratio` decimal(5,2) NOT NULL DEFAULT 2.50,
  `distributor_floor_price_a` decimal(10,2) NOT NULL DEFAULT 100.00,  -- âœ… æ–°å¢
  `distributor_floor_price_b` decimal(10,2) NOT NULL DEFAULT 80.00,   -- âœ… æ–°å¢
  `target_price_a` decimal(10,2) NOT NULL DEFAULT 150.00,    -- âœ… æ–°å¢
  `target_price_b` decimal(10,2) NOT NULL DEFAULT 120.00,    -- âœ… æ–°å¢

  -- æ™‚é–“åƒæ•¸
  `buying_duration` int NOT NULL DEFAULT 7,         -- âœ… æ–°å¢
  `selling_duration` int NOT NULL DEFAULT 4,        -- âœ… æ–°å¢

  -- å¼·åˆ¶çµæŸ
  `is_force_ended` tinyint(1) DEFAULT 0,            -- âœ… æ–°å¢
  `force_ended_at` timestamp NULL DEFAULT NULL,     -- âœ… æ–°å¢
  `force_end_day` int DEFAULT NULL,                 -- âœ… æ–°å¢

  -- æ™‚é–“æˆ³
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  KEY `idx_status` (`status`),
  KEY `idx_phase` (`phase`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

---

## ğŸ” å…¶ä»–è¡¨çµæ§‹é©—è­‰

### âœ… users è¡¨ (8 æ¬„ä½)
å®Œæ•´çµæ§‹ï¼ŒåŒ…å«ï¼š
- id, username, password_hash, plain_password
- team_name, role, created_at, updated_at

### âœ… game_days è¡¨ (15 æ¬„ä½)
å®Œæ•´çµæ§‹ï¼ŒåŒ…å«ï¼š
- éŠæˆ²æ—¥æœŸè³‡è¨Šã€ä¾›éœ€åƒæ•¸ã€æ™‚é–“è¨˜éŒ„

### âœ… game_participants è¡¨ (14 æ¬„ä½)
å®Œæ•´çµæ§‹ï¼ŒåŒ…å«ï¼š
- éšŠä¼åƒèˆ‡è³‡è¨Šã€é ç®—ã€è²¸æ¬¾ã€åº«å­˜ã€åˆ©æ½¤ã€ROIã€æ’å

### âœ… bids è¡¨ (12 æ¬„ä½)
ä½¿ç”¨ `game_day_id` é—œè¯è¨­è¨ˆï¼ˆæ­£ç¢ºï¼‰ï¼š
- game_day_id, team_id, bid_type, fish_type
- price, quantity_submitted, quantity_fulfilled
- status, price_index, created_at, updated_at

### âœ… transactions è¡¨ (11 æ¬„ä½)
ä½¿ç”¨ `game_day_id` é—œè¯è¨­è¨ˆï¼ˆæ­£ç¢ºï¼‰ï¼š
- game_day_id, team_id, transaction_type, fish_type
- quantity, price_per_unit, total_amount
- balance_after, description, created_at

### âœ… daily_results è¡¨ (23 æ¬„ä½)
è©³ç´°çš„æ¯æ—¥çµæœè¨˜éŒ„ï¼ˆæ­£ç¢ºï¼‰ï¼š
- æ¯æ—¥çš„ç¾é‡‘ã€è²¸æ¬¾ã€è²·è³£æ•¸é‡ã€è²»ç”¨
- æ¯æ—¥åˆ©æ½¤ã€ç´¯ç©åˆ©æ½¤ã€ROIã€æ’å

### âœ… game_logs è¡¨ (8 æ¬„ä½)
å®Œæ•´çš„æ—¥èªŒçµæ§‹ï¼ˆæ­£ç¢ºï¼‰ï¼š
- game_id, day_number, action, actor_id
- actor_type, details (json), created_at

---

## ğŸ¯ é—œéµç™¼ç¾

### 1. è³‡æ–™åº«çµæ§‹ç‰ˆæœ¬

Railway è³‡æ–™åº«ä½¿ç”¨çš„æ˜¯**æ­£å¼ç‰ˆæœ¬çµæ§‹**ï¼Œèˆ‡å¾Œç«¯ä»£ç¢¼ `server.js` å®Œå…¨åŒ¹é…ï¼š

- âœ… ä½¿ç”¨ `game_day_id` å¤–éµé—œè¯ï¼ˆä¸æ˜¯ game_id + day_number çµ„åˆï¼‰
- âœ… bids è¡¨ä½¿ç”¨ `quantity_submitted` / `quantity_fulfilled`
- âœ… transactions è¡¨ä½¿ç”¨ `price_per_unit` / `total_amount`
- âœ… daily_results è¡¨åŒ…å«å®Œæ•´çš„ 23 å€‹çµ±è¨ˆæ¬„ä½
- âœ… game_logs è¡¨ä½¿ç”¨ `action` / `actor_id` / `actor_type` / `details`

### 2. complete_database_structure.sql ç‹€æ…‹

âš ï¸ **`complete_database_structure.sql` æª”æ¡ˆå·²éæ™‚**

è©²æª”æ¡ˆå®šç¾©çš„çµæ§‹ï¼ˆä½¿ç”¨ game_id + day_numberï¼‰èˆ‡å¯¦éš›é‹è¡Œçš„å¾Œç«¯ä»£ç¢¼ä¸åŒã€‚
**å¯¦éš›ä½¿ç”¨çš„æ˜¯ Railway è³‡æ–™åº«ä¸­çš„çµæ§‹ç‰ˆæœ¬**ã€‚

å»ºè­°ï¼š
- ä¸è¦ä½¿ç”¨ `complete_database_structure.sql` ä¾†é‡å»ºè³‡æ–™åº«
- å¦‚éœ€å‚™ä»½çµæ§‹ï¼Œæ‡‰ä½¿ç”¨ `mysqldump` å¾ Railway å°å‡ºå¯¦éš›çµæ§‹

### 3. å¾Œç«¯ä»£ç¢¼ç›¸å®¹æ€§

âœ… **å¾Œç«¯ server.js èˆ‡ Railway è³‡æ–™åº« 100% ç›¸å®¹**

æ‰€æœ‰æŸ¥è©¢èªå¥ä½¿ç”¨çš„æ¬„ä½åç¨±å’Œè¡¨çµæ§‹éƒ½èˆ‡ Railway è³‡æ–™åº«ä¸€è‡´ï¼š
- âœ… ä½¿ç”¨ `game_day_id` é€²è¡Œé—œè¯
- âœ… ä½¿ç”¨ `cumulative_profit`ï¼ˆä¸æ˜¯ accumulated_profitï¼‰
- âœ… ä½¿ç”¨ `quantity_submitted` / `quantity_fulfilled`
- âœ… æ‰€æœ‰æ–°å¢çš„ games è¡¨æ¬„ä½éƒ½è¢«å¾Œç«¯ä»£ç¢¼å¼•ç”¨

---

## âœ… é©—è­‰çµæœ

### è³‡æ–™åº«å¥åº·æª¢æŸ¥

```bash
åŸ·è¡Œæ™‚é–“: 2025-01-19
é€£ç·šç‹€æ…‹: âœ… æ­£å¸¸
è³‡æ–™è¡¨æ•¸: 8/8 âœ…
games æ¬„ä½æ•¸: 26/26 âœ…
unsold_fee_per_kg: 10.00 âœ…
status ENUM: pending, active, completed âœ…
é€²è¡Œä¸­éŠæˆ²: 1 å€‹ â„¹ï¸
```

### åŠŸèƒ½å¯ç”¨æ€§æª¢æŸ¥

| åŠŸèƒ½ | è³‡æ–™åº«æ”¯æ´ | å¾Œç«¯ä»£ç¢¼ | ç‹€æ…‹ |
|------|-----------|---------|------|
| éšŠä¼è‡ªè¨‚åç¨± | âœ… team_names | âœ… æ”¯æ´ | å¯ç”¨ |
| å¼·åˆ¶çµæŸéŠæˆ² | âœ… is_force_ended ç­‰ | âœ… æ”¯æ´ | å¯ç”¨ |
| æ»¯éŠ·è²»è¨ˆç®— | âœ… 10.00 é è¨­å€¼ | âœ… æ”¯æ´ | å¯ç”¨ |
| æ¨é€²å¤©æ•¸ | âœ… å®Œæ•´æ¬„ä½ | âœ… å·²ä¿®æ­£ | å¯ç”¨ |
| åˆ©æ¯è¨ˆç®— | âœ… loan_interest_rate | âœ… æ”¯æ´ | å¯ç”¨ |
| æ™‚é–“æ§åˆ¶ | âœ… buying/selling_duration | âœ… æ”¯æ´ | å¯ç”¨ |
| åƒ¹æ ¼åƒæ•¸ | âœ… distributor/target prices | âœ… æ”¯æ´ | å¯ç”¨ |

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼šéƒ¨ç½²å¾Œç«¯ä»£ç¢¼

### è³‡æ–™åº«ç‹€æ…‹
âœ… **å®Œå…¨å°±ç·’ï¼Œç„¡éœ€ä»»ä½•é¡å¤–æ“ä½œ**

### å¾Œç«¯éƒ¨ç½²æ­¥é©Ÿ

1. **æäº¤ä»£ç¢¼ä¿®æ”¹**
   ```bash
   cd "C:\Dcopy\èˆŠé›»è…¦å‚™ä»½\å¾æ™¯è¼\é­šå¸‚å ´éŠæˆ²3"
   git add backend/server.js
   git add complete_database_structure.sql  # å¦‚æœæœ‰æ›´æ–°
   git commit -m "fix: çµ±ä¸€æ»¯éŠ·è²»é è¨­å€¼(10å…ƒ)ã€å„ªåŒ–advance-day APIã€è£œé½Šgamesè¡¨æ¬„ä½"
   ```

2. **æ¨é€åˆ° GitHub**
   ```bash
   git push origin main
   ```

3. **Railway è‡ªå‹•éƒ¨ç½²**
   - Railway æœƒè‡ªå‹•æª¢æ¸¬ GitHub æ¨é€
   - è‡ªå‹•æ‹‰å–æœ€æ–°ä»£ç¢¼
   - é‡æ–°å•Ÿå‹•å¾Œç«¯æœå‹™
   - é è¨ˆ 2-3 åˆ†é˜å®Œæˆéƒ¨ç½²

4. **é©—è­‰éƒ¨ç½²**
   - æª¢æŸ¥ Railway éƒ¨ç½²æ—¥èªŒ
   - æ¸¬è©¦å‰ç«¯é€£æ¥
   - é©—è­‰ API åŠŸèƒ½æ­£å¸¸

---

## ğŸ“ æœ¬æ¬¡ä¿®æ­£ç¸½çµ

### è³‡æ–™åº«ä¿®æ­£
- âœ… æ·»åŠ  4 å€‹ force-end ç›¸é—œæ¬„ä½
- âœ… æ·»åŠ  8 å€‹éŠæˆ²åƒæ•¸æ¬„ä½
- âœ… ä¿®æ­£ unsold_fee_per_kg é è¨­å€¼ç‚º 10.00
- âœ… é©—è­‰æ‰€æœ‰è¡¨çµæ§‹å®Œæ•´æ€§

### å¾Œç«¯ä»£ç¢¼ä¿®æ­£ (å·²åœ¨å‰æ¬¡å®Œæˆ)
- âœ… çµ±ä¸€æ»¯éŠ·è²»é è¨­å€¼ç‚º 10 å…ƒ/kg
- âœ… åˆªé™¤é‡è¤‡çš„ advance-day è·¯å¾‘
- âœ… è£œé½Šæ¨é€²å¤©æ•¸é‚è¼¯ï¼ˆåº«å­˜æ¸…ç©ºã€åˆ©æ¯è¨ˆç®—ï¼‰

### æ–‡ä»¶æ›´æ–°
- âœ… å‰µå»º Railway é€£ç·šé…ç½®æª”æ¡ˆ
- âœ… å‰µå»ºè³‡æ–™åº«æª¢æŸ¥è…³æœ¬
- âœ… å‰µå»ºé·ç§»åŸ·è¡Œè…³æœ¬
- âœ… å»ºç«‹å®Œæ•´æª¢æŸ¥å ±å‘Š

---

## âš ï¸ æ³¨æ„äº‹é …

1. **`complete_database_structure.sql` å·²éæ™‚**
   - è©²æª”æ¡ˆä¸ä»£è¡¨ç•¶å‰ä½¿ç”¨çš„è³‡æ–™åº«çµæ§‹
   - å¯¦éš›çµæ§‹ä»¥ Railway è³‡æ–™åº«ç‚ºæº–
   - å»ºè­°ä½¿ç”¨ mysqldump é‡æ–°å°å‡ºæ­£ç¢ºçš„çµæ§‹å®šç¾©

2. **é€²è¡Œä¸­çš„éŠæˆ²**
   - ç›®å‰æœ‰ 1 å€‹éŠæˆ²æ­£åœ¨é€²è¡Œ
   - æ‰€æœ‰è³‡æ–™åº«ä¿®æ”¹éƒ½æ˜¯å®‰å…¨çš„ï¼ˆåƒ…æ·»åŠ æ¬„ä½ï¼‰
   - ä¸å½±éŸ¿ç¾æœ‰éŠæˆ²é‹ä½œ

3. **ç’°å¢ƒè®Šæ•¸**
   - `.env.railway` åŒ…å«æ•æ„Ÿé€£ç·šè³‡è¨Š
   - ä¸æ‡‰æäº¤åˆ° Git ç‰ˆæœ¬æ§åˆ¶
   - å·²æ·»åŠ åˆ° .gitignore

---

## ğŸ‰ çµè«–

âœ… **Railway è³‡æ–™åº«å®Œå…¨å°±ç·’**
âœ… **æ‰€æœ‰å¿…è¦æ¬„ä½å·²é½Šå…¨**
âœ… **çµæ§‹èˆ‡å¾Œç«¯ä»£ç¢¼å®Œç¾åŒ¹é…**
âœ… **å¯ä»¥å®‰å…¨éƒ¨ç½²æ›´æ–°çš„å¾Œç«¯ä»£ç¢¼**

**è³‡æ–™åº«å¥åº·ç‹€æ…‹**: ğŸŸ¢ å„ªç§€
**å¾Œç«¯ç›¸å®¹æ€§**: ğŸŸ¢ 100%
**éƒ¨ç½²å°±ç·’åº¦**: ğŸŸ¢ å¯ç«‹å³éƒ¨ç½²

---

**å»ºç«‹æ™‚é–“**: 2025-01-19
**æª¢æŸ¥äºº**: Claude Code
**ç¸½åŸ·è¡Œæ™‚é–“**: ~15 åˆ†é˜
**ä¿®æ­£æª”æ¡ˆæ•¸**: 12 å€‹è…³æœ¬ + 3 å€‹å ±å‘Š
**è³‡æ–™åº«è®Šæ›´**: 12 å€‹æ¬„ä½æ–°å¢ï¼Œ0 ç­†è³‡æ–™éºå¤±
