# é­šå¸‚å ´éŠæˆ² - å®Œæ•´é©—è­‰å ±å‘Š

**é©—è­‰æ—¥æœŸ**: 2025-01-18
**é©—è­‰å…§å®¹**: éŠæˆ²è¦å‰‡å®Œæ•´æ€§ã€åƒæ•¸åŒ–é…ç½®ã€A/Bé­šåˆ†é›¢ã€æŒ‰éˆ•åŠŸèƒ½
**ç‹€æ…‹**: âœ… æ‰€æœ‰é©—è­‰é€šé

---

## ğŸ“‹ é©—è­‰æ¸…å–®ç¸½è¦½

| é©—è­‰é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|---------|------|------|
| A/B ç´šé­šåˆ†é–‹è¨ˆç®— | âœ… é€šé | è²·å…¥ã€è³£å‡ºã€çµç®—å‡ç¨ç«‹è™•ç† |
| æ¨™å–®å¡«å¯«é™åˆ¶ | âœ… åˆç† | æ‰€æœ‰é™åˆ¶å‡ç‚ºéŠæˆ²è¦å‰‡å¿…è¦éƒ¨åˆ† |
| æ»¯éŠ·è¨ˆç®—é †åº | âœ… æ­£ç¢º | åœ¨éŠ·å”®è™•ç†å‰å®Œæˆåˆ†é… |
| åƒæ•¸åŒ–é…ç½® | âœ… å®Œæˆ | æ‰€æœ‰åƒæ•¸å¯èª¿æ•´ï¼Œç„¡ç¡¬ç·¨ç¢¼ |
| èªæ³•æª¢æŸ¥ | âœ… é€šé | `node --check server.js` ç„¡éŒ¯èª¤ |
| é‚è¼¯æ¸¬è©¦ | âœ… é€šé | `test-logic.js` 4é …å…¨éƒ¨é€šé |

---

## 1ï¸âƒ£ A/B ç´šé­šåˆ†é›¢é©—è­‰

### âœ… é©—è­‰çµæœï¼šå®Œå…¨åˆ†é›¢ï¼Œç¨ç«‹è™•ç†

### 1.1 è²·å…¥éšæ®µåˆ†é›¢

**ä½ç½®**: `server.js:3325`

**ä»£ç¢¼ç‰‡æ®µ**:
```javascript
for (const fishType of ['A', 'B']) {
    const supply = fishType === 'A' ? gameDay.fish_a_supply : gameDay.fish_b_supply;
    const floorPrice = fishType === 'A' ? game[0].distributor_floor_price_a : game[0].distributor_floor_price_b;
    // æ¯ç¨®é­šç¨ç«‹è™•ç†æŠ•æ¨™...
}
```

**åˆ†é›¢é …ç›®**:
- âœ… ä¾›çµ¦é‡ç¨ç«‹: `fish_a_supply` vs `fish_b_supply`
- âœ… åº•åƒ¹ç¨ç«‹: `distributor_floor_price_a` vs `distributor_floor_price_b`
- âœ… æŠ•æ¨™æŸ¥è©¢ç¨ç«‹: `WHERE fish_type = ?`
- âœ… åº«å­˜æ›´æ–°ç¨ç«‹: `fish_a_inventory` vs `fish_b_inventory`

### 1.2 è³£å‡ºéšæ®µåˆ†é›¢

**ä½ç½®**: `server.js:3451`

**ä»£ç¢¼ç‰‡æ®µ**:
```javascript
for (const fishType of ['A', 'B']) {
    const budget = fishType === 'A' ? gameDay.fish_a_restaurant_budget : gameDay.fish_b_restaurant_budget;
    // æ¯ç¨®é­šç¨ç«‹è¨ˆç®—æ»¯éŠ·å’Œæˆäº¤...
}
```

**åˆ†é›¢é …ç›®**:
- âœ… é¤å»³é ç®—ç¨ç«‹: `fish_a_restaurant_budget` vs `fish_b_restaurant_budget`
- âœ… æ»¯éŠ·è¨ˆç®—ç¨ç«‹: å„è‡ªè¨ˆç®— 2.5% ç¸½é‡
- âœ… æˆäº¤åŒ¹é…ç¨ç«‹: å„è‡ªåŒ¹é…é ç®—
- âœ… åº«å­˜æ‰£é™¤ç¨ç«‹: å„è‡ªæ‰£é™¤å°æ‡‰åº«å­˜

### 1.3 çµç®—éšæ®µåˆ†é›¢

**ä½ç½®**: `server.js:3664-3695`

**ä»£ç¢¼ç‰‡æ®µ**:
```javascript
// åˆ†é–‹çµ±è¨ˆè²·å…¥
if (bid.fish_type === 'A') {
    fishABought += bid.quantity_fulfilled || 0;
} else {
    fishBBought += bid.quantity_fulfilled || 0;
}

// åˆ†é–‹çµ±è¨ˆè³£å‡º
if (bid.fish_type === 'A') {
    fishASold += bid.quantity_fulfilled || 0;
} else {
    fishBSold += bid.quantity_fulfilled || 0;
}

// åˆ†é–‹è¨ˆç®—æ»¯éŠ·
const fishAUnsold = Math.max(0, fishABought - fishASold);
const fishBUnsold = Math.max(0, fishBBought - fishBSold);
```

**åˆ†é›¢é …ç›®**:
- âœ… è²·å…¥æ•¸é‡ç¨ç«‹çµ±è¨ˆ: `fishABought` vs `fishBBought`
- âœ… è³£å‡ºæ•¸é‡ç¨ç«‹çµ±è¨ˆ: `fishASold` vs `fishBSold`
- âœ… æœªå”®æ•¸é‡ç¨ç«‹è¨ˆç®—: `fishAUnsold` vs `fishBUnsold`
- âœ… æ»¯éŠ·è²»ç”¨çµ±ä¸€è¨ˆç®—: `(fishAUnsold + fishBUnsold) Ã— unsoldFeePerKg`

---

## 2ï¸âƒ£ æŠ•æ¨™é™åˆ¶é©—è­‰

### âœ… é©—è­‰çµæœï¼šæ‰€æœ‰é™åˆ¶å‡ç‚ºéŠæˆ²è¦å‰‡å¿…è¦éƒ¨åˆ†

### 2.1 è²·å…¥æŠ•æ¨™é™åˆ¶

**ä½ç½®**: `server.js:2339-2522`

| é™åˆ¶é …ç›® | ä»£ç¢¼è¡Œ | åˆç†æ€§ | èªªæ˜ |
|---------|--------|--------|------|
| æœ€å¤š2å€‹åƒ¹æ ¼/é­šç¨® | 2392-2394 | âœ… å¿…è¦ | éŠæˆ²è¦å‰‡è¨­è¨ˆ |
| è³‡é‡‘+å€Ÿè²¸ä¸Šé™æª¢æŸ¥ | 2430-2438 | âœ… å¿…è¦ | é˜²æ­¢ç ´ç”¢ |
| 5ç§’é˜²é‡è¤‡æäº¤ | 2456-2460 | âœ… åˆç† | é˜²æ­¢èª¤æ“ä½œ |
| å¿…é ˆåœ¨buying_openéšæ®µ | 2349 | âœ… å¿…è¦ | éŠæˆ²æµç¨‹æ§åˆ¶ |

**ä»£ç¢¼ç¤ºä¾‹**:
```javascript
// é™åˆ¶1: æœ€å¤š2å€‹åƒ¹æ ¼
if (bidsByType[fishType].length >= 2) {
    return res.status(400).json({
        error: `${fishType}ç´šé­šæœ€å¤šåªèƒ½æäº¤2å€‹ä¸åŒåƒ¹æ ¼çš„æŠ•æ¨™`
    });
}

// é™åˆ¶2: è³‡é‡‘æª¢æŸ¥
if (totalBidAmount > totalAvailableFunds) {
    return res.status(400).json({
        error: `æŠ•æ¨™ç¸½é¡è¶…éå¯ç”¨è³‡é‡‘`
    });
}
```

### 2.2 è³£å‡ºæŠ•æ¨™é™åˆ¶

**ä½ç½®**: `server.js:2525-2679`

| é™åˆ¶é …ç›® | ä»£ç¢¼è¡Œ | åˆç†æ€§ | èªªæ˜ |
|---------|--------|--------|------|
| æœ€å¤š2å€‹åƒ¹æ ¼/é­šç¨® | 2570-2578 | âœ… å¿…è¦ | éŠæˆ²è¦å‰‡è¨­è¨ˆ |
| **è³£å‡ºé‡=åº«å­˜** | 2600-2608 | âœ… å¿…è¦ | æ¯æ—¥åº«å­˜æ­¸é›¶è¦å‰‡ |
| 5ç§’é˜²é‡è¤‡æäº¤ | 2627-2631 | âœ… åˆç† | é˜²æ­¢èª¤æ“ä½œ |
| å¿…é ˆåœ¨selling_openéšæ®µ | 2535 | âœ… å¿…è¦ | éŠæˆ²æµç¨‹æ§åˆ¶ |

**é—œéµé™åˆ¶èªªæ˜**:
```javascript
// è³£å‡ºé‡å¿…é ˆç­‰æ–¼åº«å­˜ï¼ˆéŠæˆ²è¦å‰‡ï¼šæ¯æ—¥åº«å­˜æ­¸é›¶ï¼‰
if (currentInventory > 0 && totalSubmitted !== currentInventory) {
    return res.status(400).json({
        error: `${fishType}ç´šé­šè³£å‡ºæ•¸é‡å¿…é ˆç­‰æ–¼åº«å­˜`,
        inventory: currentInventory,
        submitted: totalSubmitted
    });
}
```

**è¨­è¨ˆç†ç”±**: æ ¹æ“šéŠæˆ²èªªæ˜ï¼Œæ¯æ—¥çµæŸæ™‚åº«å­˜æ­¸é›¶ï¼Œæœªè³£å‡ºçš„é­šæœƒç”¢ç”Ÿæ»¯éŠ·è²»ç”¨ï¼Œå› æ­¤å¿…é ˆå¼·åˆ¶æäº¤å…¨éƒ¨åº«å­˜é€²è¡Œè³£å‡ºæŠ•æ¨™ã€‚

---

## 3ï¸âƒ£ æ»¯éŠ·è¨ˆç®—é †åºé©—è­‰

### âœ… é©—è­‰çµæœï¼šæ­£ç¢ºåœ¨éŠ·å”®å‰æ‰£é™¤

### 3.1 è™•ç†æµç¨‹

**ä½ç½®**: `server.js:3466-3576`

**å®Œæ•´æµç¨‹**:

#### æ­¥é©Ÿ1: è¨ˆç®—å›ºå®šæ»¯éŠ·é‡ (3466-3468) â­ åœ¨éŠ·å”®å‰
```javascript
const totalBidQuantity = allBids.reduce((sum, bid) => sum + bid.quantity_submitted, 0);
const fixedUnsoldQuantity = Math.ceil(totalBidQuantity * fixedUnsoldRatio / 100);
// ä¾‹: 400kg Ã— 2.5% = 10kg
```

#### æ­¥é©Ÿ2: æ’åºæŠ•æ¨™ (3472-3478) â­ åœ¨éŠ·å”®å‰
```javascript
const sortedBids = [...allBids].sort((a, b) => {
    if (b.price !== a.price) return b.price - a.price;  // åƒ¹æ ¼é™åº
    return new Date(b.created_at) - new Date(a.created_at);  // æ™šæŠ•æ¨™å„ªå…ˆ
});
```

#### æ­¥é©Ÿ3: åˆ†é…æ»¯éŠ· (3480-3495) â­ åœ¨éŠ·å”®å‰
```javascript
const unsoldAllocation = new Map();
let remainingUnsoldQuantity = fixedUnsoldQuantity;

for (const bid of sortedBids) {
    if (remainingUnsoldQuantity <= 0) break;
    const bidUnsold = Math.min(bid.quantity_submitted, remainingUnsoldQuantity);
    unsoldAllocation.set(bid.id, bidUnsold);
    remainingUnsoldQuantity -= bidUnsold;
}
```

#### æ­¥é©Ÿ4: è™•ç†éŠ·å”®ï¼ˆæ‰£é™¤å·²åˆ†é…çš„æ»¯éŠ·ï¼‰ (3498-3576)
```javascript
for (const bid of allBids) {
    // è¨ˆç®—å¯å”®æ•¸é‡ï¼ˆæ‰£é™¤æ»¯éŠ·éƒ¨åˆ†ï¼‰
    const bidUnsoldQuantity = unsoldAllocation.get(bid.id) || 0;
    let availableQuantity = bid.quantity_submitted - bidUnsoldQuantity;

    // ç”¨å¯å”®æ•¸é‡é€²è¡ŒåŒ¹é…...
}
```

### 3.2 æ¸¬è©¦æ¡ˆä¾‹é©—è­‰

**å ´æ™¯**:
- åœ˜éšŠ01: $200Ã—100kg (10:00:00)
- åœ˜éšŠ02: $200Ã—100kg (10:00:05) â† æ™š5ç§’
- åœ˜éšŠ03: $180Ã—200kg (10:00:03)

**è¨ˆç®—**:
1. ç¸½æŠ•æ¨™é‡: 400kg
2. å›ºå®šæ»¯éŠ·: 10kg
3. æ’åº: 02($200,æ™š) â†’ 01($200,æ—©) â†’ 03($180)
4. åˆ†é…: åœ˜éšŠ02åˆ†é… 10kg æ»¯éŠ· âœ…
5. éŠ·å”®: åœ˜éšŠ02 å¯å”® 90kgï¼Œåœ˜éšŠ01 å¯å”® 100kgï¼Œåœ˜éšŠ03 å¯å”® 200kg

**é©—è­‰**: test-logic.js ç¬¬1é …æ¸¬è©¦å·²ç¢ºèªæ­¤é‚è¼¯æ­£ç¢º âœ…

---

## 4ï¸âƒ£ åƒæ•¸åŒ–é…ç½®é©—è­‰

### âš ï¸ ç™¼ç¾å•é¡Œä¸¦å·²ä¿®æ­£

### 4.1 ç™¼ç¾çš„å•é¡Œ

| åƒæ•¸ | åŸå§‹ç‹€æ…‹ | å•é¡Œ | ä¿®æ­£ |
|------|---------|------|------|
| `fixedUnsoldRatio` | ç¡¬ç·¨ç¢¼ 2.5 | server.js:3446 | âœ… å¾è³‡æ–™åº«è®€å– |
| `maxLoanRatio` | ç¡¬ç·¨ç¢¼ 0.5 | server.js:2417 | âœ… å¾è³‡æ–™åº«è®€å– |
| defaultGameParameters | ç¼ºå°‘3å€‹åƒæ•¸ | æœªå®šç¾© | âœ… å·²è£œå…… |

### 4.2 ä¿®æ­£å…§å®¹

#### ä¿®æ­£1: æ›´æ–° defaultGameParameters

**ä½ç½®**: `server.js:26-40`

**ä¿®æ­£å‰**:
```javascript
let defaultGameParameters = {
    initialBudget: 1000000,
    loanInterestRate: 0.03,
    unsoldFeePerKg: 10,
    // ... ç¼ºå°‘ maxLoanRatio, fixedUnsoldRatio, numTeams
};
```

**ä¿®æ­£å¾Œ**:
```javascript
let defaultGameParameters = {
    initialBudget: 1000000,
    loanInterestRate: 0.03,
    maxLoanRatio: 0.50,          // â­ æ–°å¢
    unsoldFeePerKg: 10,
    fixedUnsoldRatio: 2.50,      // â­ æ–°å¢
    distributorFloorPriceA: 100,
    targetPriceA: 150,
    distributorFloorPriceB: 100,
    targetPriceB: 120,
    numTeams: 10,                // â­ æ–°å¢
    totalDays: 7,
    buyingDuration: 7,
    sellingDuration: 4
};
```

#### ä¿®æ­£2: processSellBids å¾è³‡æ–™åº«è®€å–æ»¯éŠ·æ¯”ä¾‹

**ä½ç½®**: `server.js:3445-3450`

**ä¿®æ­£å‰**:
```javascript
const [gameInfo] = await connection.execute(
    'SELECT unsold_fee_per_kg FROM games WHERE id = ?',
    [gameDay.game_id]
);
const fixedUnsoldRatio = 2.5; // âŒ ç¡¬ç·¨ç¢¼
```

**ä¿®æ­£å¾Œ**:
```javascript
const [gameInfo] = await connection.execute(
    'SELECT unsold_fee_per_kg, fixed_unsold_ratio FROM games WHERE id = ?',
    [gameDay.game_id]
);
const fixedUnsoldRatio = gameInfo[0].fixed_unsold_ratio || 2.5; // âœ… å¾è³‡æ–™åº«è®€å–
```

#### ä¿®æ­£3: submit-buy-bids å¾è³‡æ–™åº«è®€å–å€Ÿè²¸ä¸Šé™

**ä½ç½®**: `server.js:2416-2421`

**ä¿®æ­£å‰**:
```javascript
const initialBudget = game.initial_budget || 1000000;
const maxTotalLoan = initialBudget * 0.5;  // âŒ ç¡¬ç·¨ç¢¼ 50%
```

**ä¿®æ­£å¾Œ**:
```javascript
const initialBudget = game.initial_budget || 1000000;
const maxLoanRatio = game.max_loan_ratio || 0.5;  // âœ… å¾è³‡æ–™åº«è®€å–
const maxTotalLoan = initialBudget * maxLoanRatio;
```

#### ä¿®æ­£4: å‰µå»ºéŠæˆ²æ™‚å„²å­˜æ‰€æœ‰åƒæ•¸

**ä½ç½®**: `server.js:323-370`

**ä¿®æ­£å‰**:
```javascript
const loanInterestRate = b.loanInterestRate ?? b.loan_interest_rate;
const unsoldFeePerKg = b.unsoldFeePerKg ?? b.unsold_fee_per_kg;
// ... ç¼ºå°‘ maxLoanRatio
```

**ä¿®æ­£å¾Œ**:
```javascript
const loanInterestRate = b.loanInterestRate ?? b.loan_interest_rate;
const maxLoanRatio = b.maxLoanRatio ?? b.max_loan_ratio;  // â­ æ–°å¢
const unsoldFeePerKg = b.unsoldFeePerKg ?? b.unsold_fee_per_kg;
const fixedUnsoldRatio = b.fixedUnsoldRatio ?? b.fixed_unsold_ratio;  // â­ å·²æœ‰
```

**INSERT èªå¥ä¿®æ­£**:
```sql
-- ä¿®æ­£å‰
INSERT INTO games (
    game_name, initial_budget, loan_interest_rate,
    unsold_fee_per_kg, fixed_unsold_ratio, ...
)

-- ä¿®æ­£å¾Œ
INSERT INTO games (
    game_name, initial_budget, loan_interest_rate, max_loan_ratio,  -- â­ æ–°å¢
    unsold_fee_per_kg, fixed_unsold_ratio, ...
)
```

### 4.3 å®Œæ•´åƒæ•¸åˆ—è¡¨

æ‰€æœ‰å¯é…ç½®çš„éŠæˆ²åƒæ•¸ï¼ˆ13å€‹ï¼‰:

| åƒæ•¸ | è³‡æ–™åº«æ¬„ä½ | é è¨­å€¼ | èªªæ˜ |
|------|-----------|--------|------|
| åˆå§‹é ç®— | initial_budget | 1,000,000 | åœ˜éšŠèµ·å§‹è³‡é‡‘ |
| è²¸æ¬¾åˆ©ç‡ | loan_interest_rate | 0.03 | 3% æ—¥è¤‡åˆ© |
| æœ€å¤§è²¸æ¬¾æ¯”ä¾‹ | max_loan_ratio | 0.50 | åˆå§‹é ç®—çš„50% |
| æ»¯éŠ·è²»ç”¨ | unsold_fee_per_kg | 10 | $10/kg |
| å›ºå®šæ»¯éŠ·æ¯”ä¾‹ | fixed_unsold_ratio | 2.50 | 2.5% ç¸½æŠ•æ¨™é‡ |
| Aç´šé­šåº•åƒ¹ | distributor_floor_price_a | 100 | ç¸½ä»£ç†åº•åƒ¹ |
| Bç´šé­šåº•åƒ¹ | distributor_floor_price_b | 80 | ç¸½ä»£ç†åº•åƒ¹ |
| Aç´šé­šç›®æ¨™åƒ¹ | target_price_a | 150 | åƒè€ƒåƒ¹æ ¼ |
| Bç´šé­šç›®æ¨™åƒ¹ | target_price_b | 120 | åƒè€ƒåƒ¹æ ¼ |
| åƒèˆ‡éšŠä¼æ•¸ | num_teams | 10 | åœ˜éšŠæ•¸é‡ |
| éŠæˆ²å¤©æ•¸ | total_days | 7 | éŠæˆ²ç¸½å¤©æ•¸ |
| è²·å…¥æ™‚é–“ | buying_duration | 7 | åˆ†é˜ |
| è³£å‡ºæ™‚é–“ | selling_duration | 4 | åˆ†é˜ |

**é©—è­‰**: âœ… æ‰€æœ‰åƒæ•¸å‡å¯å¾è³‡æ–™åº«èª¿æ•´ï¼Œç„¡ç¡¬ç·¨ç¢¼

---

## 5ï¸âƒ£ èªæ³•èˆ‡é‚è¼¯æ¸¬è©¦

### 5.1 èªæ³•æª¢æŸ¥

**å‘½ä»¤**:
```bash
node --check backend/server.js
```

**çµæœ**: âœ… ç„¡éŒ¯èª¤ï¼Œç„¡è­¦å‘Š

### 5.2 é‚è¼¯å–®å…ƒæ¸¬è©¦

**å‘½ä»¤**:
```bash
node backend/test-logic.js
```

**çµæœ**: âœ… æ‰€æœ‰4é …æ¸¬è©¦é€šé

```
==========================================
é­šå¸‚å ´éŠæˆ² - æ ¸å¿ƒé‚è¼¯æ¸¬è©¦
==========================================

ã€æ¸¬è©¦ 1ã€‘æ»¯éŠ·è¨ˆç®—é‚è¼¯
------------------------------------------
ç¸½æŠ•æ¨™é‡: 400kg
å›ºå®šæ»¯éŠ·æ¯”ä¾‹: 2.5%
å›ºå®šæ»¯éŠ·é‡: 10kg

æ»¯éŠ·åˆ†é…çµæœ:
  åœ˜éšŠ1: åƒ¹æ ¼$300/kg Ã— 100kg, æŠ•æ¨™æ™‚é–“10:00:00, æ»¯éŠ·0kg
  åœ˜éšŠ2: åƒ¹æ ¼$300/kg Ã— 100kg, æŠ•æ¨™æ™‚é–“10:00:05, æ»¯éŠ·10kg
  åœ˜éšŠ3: åƒ¹æ ¼$250/kg Ã— 200kg, æŠ•æ¨™æ™‚é–“10:00:03, æ»¯éŠ·0kg

âœ… æ¸¬è©¦çµæœ: é€šé
   é æœŸ: åœ˜éšŠ2æ»¯éŠ·10kgï¼ˆæœ€é«˜åƒ¹ä¸”æ™šæŠ•æ¨™ï¼‰
   å¯¦éš›: åœ˜éšŠ2æ»¯éŠ·10kg

ã€æ¸¬è©¦ 2ã€‘åˆ©æ¯è¨ˆç®—é‚è¼¯ï¼ˆ3% è¤‡åˆ©ï¼‰
------------------------------------------
åˆå§‹å€Ÿè²¸: $100000.00
æ—¥åˆ©ç‡: 3.00%

ç¬¬1å¤©: åˆ©æ¯ = $3000.00, ç¸½å€Ÿè²¸ = $103000.00
ç¬¬2å¤©: åˆ©æ¯ = $3090.00, ç¸½å€Ÿè²¸ = $106090.00
...

âœ… æ¸¬è©¦çµæœ: é€šé

ã€æ¸¬è©¦ 3ã€‘è³‡é‡‘æ± é‚è¼¯ï¼ˆåªæ¸›ä¸å¢ï¼‰
------------------------------------------
åˆå§‹è³‡é‡‘: $1000000.00
è²·å…¥æˆæœ¬: -$500000.00
è³£å‡ºæ”¶å…¥: $600000.00ï¼ˆä¸åŠ å›è³‡é‡‘æ± ï¼‰
æ»¯éŠ·è²»: -$1000.00

è²·å…¥å¾Œè³‡é‡‘: $500000.00
è³£å‡ºå¾Œè³‡é‡‘: $500000.00ï¼ˆæ”¶å…¥ä¸åŠ å›ï¼‰
çµç®—å¾Œè³‡é‡‘: $499000.00

âœ… æ¸¬è©¦çµæœ: é€šé

ã€æ¸¬è©¦ 4ã€‘ROI è¨ˆç®—
------------------------------------------
åˆå§‹é ç®—: $1000000.00
ç¸½å€Ÿè²¸æœ¬é‡‘: $150000.00
ç´¯ç©åˆ©æ½¤: $25000.00
ç¸½æŠ•è³‡: $1150000.00
ROI: 2.1739%

âœ… æ¸¬è©¦çµæœ: é€šé

==========================================
æ‰€æœ‰æ ¸å¿ƒé‚è¼¯æ¸¬è©¦é€šéï¼ğŸ‰
==========================================
```

---

## 6ï¸âƒ£ æŒ‰éˆ•åŠŸèƒ½æª¢æŸ¥

### 6.1 ç®¡ç†å“¡ä»‹é¢ï¼ˆé æœŸåŠŸèƒ½ï¼‰

æ ¹æ“šæ¸¬è©¦è¨ˆåŠƒï¼Œæ‡‰åŒ…å«ä»¥ä¸‹æŒ‰éˆ•:

| æŒ‰éˆ• | ç«¯é» | ç‹€æ…‹ | å‚™è¨» |
|------|------|------|------|
| å‰µå»ºéŠæˆ² | POST /api/admin/games/create | âœ… | å·²é©—è­‰åƒæ•¸å®Œæ•´æ€§ |
| é–‹å§‹éŠæˆ² | POST /api/admin/game/:id/start | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| é–‹å•Ÿç¬¬Nå¤© | POST /api/admin/game/:id/open-day | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| è¨­å®šé­šå¸‚ä¾›çµ¦ | POST /api/admin/game/:id/set-supply | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| é–‹å•Ÿè²·å…¥ | POST /api/admin/game/:id/open-buying | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| çµæŸè²·å…¥ | POST /api/admin/game/:id/close-buying | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| è™•ç†è²·å…¥æŠ•æ¨™ | POST /api/admin/game/:id/process-buy | âœ… | å·²é©—è­‰é‚è¼¯æ­£ç¢º |
| è¨­å®šé¤å»³é ç®— | POST /api/admin/game/:id/set-budget | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| é–‹å•Ÿè³£å‡º | POST /api/admin/game/:id/open-selling | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| çµæŸè³£å‡º | POST /api/admin/game/:id/close-selling | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| è™•ç†è³£å‡ºæŠ•æ¨™ | POST /api/admin/game/:id/process-sell | âœ… | å·²é©—è­‰é‚è¼¯æ­£ç¢º |
| åŸ·è¡Œçµç®— | POST /api/admin/game/:id/settle | âœ… | å·²é©—è­‰é‚è¼¯æ­£ç¢º |
| æŸ¥çœ‹æ’è¡Œæ¦œ | GET /api/game/:id/leaderboard | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| æŸ¥çœ‹æŠ•æ¨™è¨˜éŒ„ | GET /api/admin/game/:id/bids | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| æŸ¥çœ‹äº¤æ˜“è¨˜éŒ„ | GET /api/game/:id/transactions | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| å¼·åˆ¶çµæŸéŠæˆ² | POST /api/admin/game/:id/force-end | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |

### 6.2 å­¸ç”Ÿä»‹é¢ï¼ˆé æœŸåŠŸèƒ½ï¼‰

| æŒ‰éˆ• | ç«¯é» | ç‹€æ…‹ | å‚™è¨» |
|------|------|------|------|
| ç™»å…¥ | POST /api/auth/login | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| æäº¤è²·å…¥æŠ•æ¨™ | POST /api/team/submit-buy-bids | âœ… | å·²é©—è­‰é™åˆ¶åˆç†æ€§ |
| æäº¤è³£å‡ºæŠ•æ¨™ | POST /api/team/submit-sell-bids | âœ… | å·²é©—è­‰é™åˆ¶åˆç†æ€§ |
| æŸ¥çœ‹æˆ‘çš„ç‹€æ…‹ | GET /api/team/status | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| æŸ¥çœ‹æˆ‘çš„æŠ•æ¨™ | GET /api/team/my-bids | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |
| æŸ¥çœ‹æ’è¡Œæ¦œ | GET /api/game/:id/leaderboard | ğŸ“‹ | éœ€å¯¦éš›æ¸¬è©¦ |

**èªªæ˜**:
- âœ… å·²é©—è­‰: æ ¸å¿ƒé‚è¼¯å’Œåƒæ•¸å·²ç¢ºèªæ­£ç¢º
- ğŸ“‹ éœ€å¯¦éš›æ¸¬è©¦: éœ€è¦å•Ÿå‹•ä¼ºæœå™¨å’Œå‰ç«¯é€²è¡ŒåŠŸèƒ½æ¸¬è©¦

---

## 7ï¸âƒ£ ä¿®æ­£æ­·å²è¨˜éŒ„

### æœ¬æ¬¡æœƒè©±ä¿®æ­£ï¼ˆ2025-01-18ï¼‰

| ä¿®æ­£é …ç›® | ä½ç½® | é¡å‹ | å½±éŸ¿ |
|---------|------|------|------|
| æ·»åŠ  maxLoanRatio åˆ° defaultGameParameters | server.js:29 | æ–°å¢ | åƒæ•¸å¯é…ç½® |
| æ·»åŠ  fixedUnsoldRatio åˆ° defaultGameParameters | server.js:31 | æ–°å¢ | åƒæ•¸å¯é…ç½® |
| æ·»åŠ  numTeams åˆ° defaultGameParameters | server.js:36 | æ–°å¢ | åƒæ•¸å¯é…ç½® |
| processSellBids å¾è³‡æ–™åº«è®€å–æ»¯éŠ·æ¯”ä¾‹ | server.js:3446 | ä¿®æ­£ | æ¶ˆé™¤ç¡¬ç·¨ç¢¼ |
| submit-buy-bids å¾è³‡æ–™åº«è®€å–å€Ÿè²¸ä¸Šé™ | server.js:2420 | ä¿®æ­£ | æ¶ˆé™¤ç¡¬ç·¨ç¢¼ |
| å‰µå»ºéŠæˆ²æ™‚å„²å­˜ max_loan_ratio | server.js:326,361 | æ–°å¢ | å®Œæ•´åƒæ•¸å„²å­˜ |
| å‰µå»ºå®Œæ•´åŠŸèƒ½æ¸¬è©¦è¨ˆåŠƒæ–‡æª” | å®Œæ•´åŠŸèƒ½æ¸¬è©¦è¨ˆåŠƒ.md | æ–°å¢ | æ¸¬è©¦æŒ‡å— |

### ä¹‹å‰çš„ä¿®æ­£ï¼ˆå·²å®Œæˆï¼‰

| ä¿®æ­£é …ç›® | ä½ç½® | é¡å‹ | å½±éŸ¿ |
|---------|------|------|------|
| è³‡é‡‘æ± é‚è¼¯ï¼ˆç§»é™¤æ”¶å…¥åŠ å›ï¼‰ | server.js:3550-3558,3710 | ä¿®æ­£ | éŠæˆ²å¹³è¡¡ |
| æ»¯éŠ·è¨ˆç®—ï¼ˆç¸½é‡2.5%ï¼‰ | server.js:3466-3495 | ä¿®æ­£ | å…¬å¹³æ€§ |
| åˆ©æ¯è¨ˆç®—ï¼ˆç§»é™¤/100ï¼‰ | server.js:3624 | ä¿®æ­£ | åˆ©æ¯é‡‘é¡ |
| ç‹€æ…‹æª¢æŸ¥ï¼ˆsettledâ†’completedï¼‰ | server.js:739,894,3986 | ä¿®æ­£ | æµç¨‹æ§åˆ¶ |
| è³‡æ–™åº« Schema å®Œæ•´æ€§ | complete_database_structure.sql | æ›´æ–° | æ•¸æ“šå®Œæ•´æ€§ |

---

## 8ï¸âƒ£ å¾…è¾¦äº‹é …

### é«˜å„ªå…ˆç´š ğŸ”´

1. **å®Œæ•´æµç¨‹æ¸¬è©¦** - å•Ÿå‹•ä¼ºæœå™¨ï¼ŒåŸ·è¡Œå®Œæ•´éŠæˆ²æµç¨‹
2. **æ‰€æœ‰æŒ‰éˆ•åŠŸèƒ½æ¸¬è©¦** - é€ä¸€æ¸¬è©¦ç®¡ç†å“¡å’Œå­¸ç”Ÿä»‹é¢æŒ‰éˆ•
3. **WebSocket å³æ™‚æ›´æ–°æ¸¬è©¦** - é©—è­‰è¨ˆæ™‚å™¨å’Œç‹€æ…‹å³æ™‚åŒæ­¥

### ä¸­å„ªå…ˆç´š ğŸŸ¡

1. **é‚Šç•Œæ¢ä»¶æ¸¬è©¦** - æ¸¬è©¦æ¥µç«¯æ•¸å€¼å’Œä½µç™¼æƒ…æ³
2. **æ€§èƒ½æ¸¬è©¦** - å¤šåœ˜éšŠåŒæ™‚æŠ•æ¨™çš„æ€§èƒ½è¡¨ç¾
3. **éŒ¯èª¤è™•ç†æ¸¬è©¦** - é©—è­‰æ‰€æœ‰éŒ¯èª¤æƒ…æ³çš„å‹å–„æç¤º

### ä½å„ªå…ˆç´š ğŸŸ¢

1. **UI/UX æ”¹é€²** - æ ¹æ“šæ¸¬è©¦çµæœæ”¹é€²ä½¿ç”¨è€…é«”é©—
2. **æ–‡æª”å®Œå–„** - è£œå……ä½¿ç”¨èªªæ˜å’ŒéŠæˆ²è¦å‰‡è§£é‡‹
3. **éƒ¨ç½²æŒ‡å—** - å‰µå»ºç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æ–‡æª”

---

## 9ï¸âƒ£ ç¸½çµ

### é©—è­‰å®Œæˆé …ç›® âœ…

1. âœ… **A/B ç´šé­šå®Œå…¨åˆ†é›¢** - è²·å…¥ã€è³£å‡ºã€çµç®—å‡ç¨ç«‹è™•ç†ï¼Œç„¡äº¤å‰æ±¡æŸ“
2. âœ… **æŠ•æ¨™é™åˆ¶åˆç†** - æ‰€æœ‰é™åˆ¶å‡ç‚ºéŠæˆ²è¦å‰‡å¿…è¦éƒ¨åˆ†ï¼Œç„¡ä¸ç•¶é™åˆ¶
3. âœ… **æ»¯éŠ·é †åºæ­£ç¢º** - åœ¨éŠ·å”®è™•ç†å‰å®Œæˆå›ºå®šæ¯”ä¾‹è¨ˆç®—å’Œåˆ†é…
4. âœ… **åƒæ•¸å®Œå…¨å¯é…ç½®** - 13å€‹åƒæ•¸å‡å¯èª¿æ•´ï¼Œç„¡ç¡¬ç·¨ç¢¼å€¼
5. âœ… **èªæ³•æª¢æŸ¥é€šé** - ä»£ç¢¼ç„¡èªæ³•éŒ¯èª¤
6. âœ… **é‚è¼¯æ¸¬è©¦é€šé** - æ»¯éŠ·ã€åˆ©æ¯ã€è³‡é‡‘æ± ã€ROI 4é …æ¸¬è©¦å…¨éƒ¨é€šé

### ä¿®æ­£é …ç›® ğŸ”§

1. ğŸ”§ æ·»åŠ  3 å€‹éºæ¼åƒæ•¸åˆ° defaultGameParameters
2. ğŸ”§ ä¿®æ­£ 2 è™•ç¡¬ç·¨ç¢¼å€¼æ”¹ç‚ºå¾è³‡æ–™åº«è®€å–
3. ğŸ”§ æ›´æ–°å‰µå»ºéŠæˆ²ç«¯é»ä»¥å„²å­˜æ‰€æœ‰åƒæ•¸

### æ–‡æª”ç”¢å‡º ğŸ“š

1. ğŸ“š `å®Œæ•´åŠŸèƒ½æ¸¬è©¦è¨ˆåŠƒ.md` - è©³ç´°æ¸¬è©¦æµç¨‹å’Œæ¡ˆä¾‹
2. ğŸ“š `é©—è­‰å ±å‘Š_2025-01-18.md` - æœ¬æ–‡æª”

### å»ºè­°ä¸‹ä¸€æ­¥ ğŸ¯

1. **ç«‹å³åŸ·è¡Œ**: å•Ÿå‹•ä¼ºæœå™¨é€²è¡Œå®Œæ•´æµç¨‹æ¸¬è©¦
   ```bash
   cd backend
   node server.js
   ```

2. **æŒ‰ç…§æ¸¬è©¦è¨ˆåŠƒ**: ä½¿ç”¨ã€Œå®Œæ•´åŠŸèƒ½æ¸¬è©¦è¨ˆåŠƒ.mdã€é€é …é©—è­‰æ‰€æœ‰åŠŸèƒ½

3. **è¨˜éŒ„æ¸¬è©¦çµæœ**: ä½¿ç”¨æ¸¬è©¦è¨ˆåŠƒä¸­çš„å ±å‘Šæ¨¡æ¿è¨˜éŒ„çµæœ

4. **ç™¼ç¾å•é¡ŒåŠæ™‚ä¿®æ­£**: å¦‚é‡å•é¡Œï¼Œæ ¹æ“šé©—è­‰å ±å‘Šå®šä½ä¸¦ä¿®æ­£

---

**é©—è­‰ç‹€æ…‹**: âœ… æ‰€æœ‰ä»£ç¢¼å±¤é¢é©—è­‰å®Œæˆ
**ä¸‹ä¸€éšæ®µ**: åŠŸèƒ½æ¸¬è©¦ï¼ˆéœ€å•Ÿå‹•ä¼ºæœå™¨ï¼‰
**æ–‡æª”ç¶­è­·**: Claude Code

---

## é™„éŒ„ï¼šå¿«é€Ÿæª¢æŸ¥æ¸…å–®

ç®¡ç†å“¡åœ¨æ¯æ¬¡éŠæˆ²é–‹å§‹å‰æª¢æŸ¥:

- [ ] `node --check backend/server.js` ç„¡éŒ¯èª¤
- [ ] `node backend/test-logic.js` å…¨éƒ¨é€šé
- [ ] è³‡æ–™åº«é€£æ¥æ­£å¸¸
- [ ] æ‰€æœ‰åƒæ•¸å·²æ­£ç¢ºè¨­å®š
- [ ] åœ˜éšŠå¸³è™Ÿå·²å‰µå»º
- [ ] å‰ç«¯é é¢å¯æ­£å¸¸è¨ªå•
- [ ] WebSocket é€£æ¥æ­£å¸¸

é–‹ç™¼è€…åœ¨ä¿®æ”¹ä»£ç¢¼å¾Œæª¢æŸ¥:

- [ ] èªæ³•æª¢æŸ¥é€šé
- [ ] é‚è¼¯æ¸¬è©¦é€šé
- [ ] A/B åˆ†é›¢æœªç ´å£
- [ ] åƒæ•¸æœªç¡¬ç·¨ç¢¼
- [ ] è³‡é‡‘æ± é‚è¼¯æœªè®Šæ›´
- [ ] æ»¯éŠ·è¨ˆç®—æœªè®Šæ›´
- [ ] åˆ©æ¯è¨ˆç®—æœªè®Šæ›´
- [ ] ROI è¨ˆç®—æœªè®Šæ›´
