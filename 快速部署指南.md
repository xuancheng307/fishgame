# å¿«é€Ÿéƒ¨ç½²æŒ‡å—

**æ›´æ–°æ—¥æœŸ**: 2025-01-18
**ç‰ˆæœ¬**: v1.0ï¼ˆæ‰€æœ‰åŠŸèƒ½æ€§å•é¡Œå·²ä¿®æ­£ï¼‰

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ï¼ˆ3 æ­¥é©Ÿï¼‰

### æ­¥é©Ÿ 1: åŸ·è¡Œè³‡æ–™åº«é·ç§» âš¡

```bash
mysql -u root -p fishmarket_game < migrations/001_add_team_names.sql
```

**é©—è­‰**:
```bash
mysql -u root -p fishmarket_game -e "DESCRIBE games;" | grep team_names
```

é æœŸçœ‹åˆ°:
```
team_names | json | YES | NULL | éšŠä¼åç¨±æ˜ å°„ {teamId: displayName}
```

---

### æ­¥é©Ÿ 2: å•Ÿå‹•ä¼ºæœå™¨ ğŸ–¥ï¸

```bash
cd backend
node server.js
```

é æœŸè¼¸å‡º:
```
è³‡æ–™åº«é€£æ¥æˆåŠŸ
Server running on port 3000
```

---

### æ­¥é©Ÿ 3: æ¸¬è©¦è¨ªå• âœ…

**ç€è¦½å™¨æ‰“é–‹**:
```
http://localhost:3000/admin.html
```

æ‡‰è©²çœ‹åˆ°ç®¡ç†å“¡ä»‹é¢æ­£å¸¸é¡¯ç¤ºã€‚

---

## ğŸ“‹ å®Œæ•´éƒ¨ç½²æ­¥é©Ÿ

### å‰ç½®æª¢æŸ¥

```bash
# 1. æª¢æŸ¥ Node.js ç‰ˆæœ¬
node --version
# éœ€è¦ v14 æˆ–ä»¥ä¸Š

# 2. æª¢æŸ¥ MySQL æœå‹™
mysql --version

# 3. æª¢æŸ¥è³‡æ–™åº«å­˜åœ¨
mysql -u root -p -e "SHOW DATABASES LIKE 'fishmarket_game';"
```

---

### è³‡æ–™åº«è¨­ç½®

#### é¸é … A: å…¨æ–°è³‡æ–™åº«

```bash
# 1. å‰µå»ºè³‡æ–™åº«ä¸¦å°å…¥å®Œæ•´ schema
mysql -u root -p < complete_database_structure.sql

# 2. å°å…¥ç¨®å­è³‡æ–™ï¼ˆå¯é¸ï¼‰
mysql -u root -p fishmarket_game < seed_users.sql
mysql -u root -p fishmarket_game < seed_demo_game.sql
```

#### é¸é … B: ç¾æœ‰è³‡æ–™åº«

```bash
# åƒ…åŸ·è¡Œé·ç§»è…³æœ¬æ·»åŠ  team_names æ¬„ä½
mysql -u root -p fishmarket_game < migrations/001_add_team_names.sql
```

**é©—è­‰è³‡æ–™åº«**:
```sql
USE fishmarket_game;

-- æª¢æŸ¥æ‰€æœ‰è¡¨
SHOW TABLES;

-- æª¢æŸ¥ games è¡¨çµæ§‹
DESCRIBE games;

-- æª¢æŸ¥ç¾æœ‰è³‡æ–™
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM games;
```

---

### å¾Œç«¯è¨­ç½®

```bash
# 1. é€²å…¥å¾Œç«¯ç›®éŒ„
cd backend

# 2. å®‰è£ä¾è³´ï¼ˆå¦‚æœéœ€è¦ï¼‰
npm install

# 3. æª¢æŸ¥é…ç½®ï¼ˆå¯é¸ï¼‰
# ç·¨è¼¯ server.js ä¸­çš„è³‡æ–™åº«é€£æ¥è¨­å®šï¼ˆå¦‚éœ€ä¿®æ”¹ï¼‰
# é è¨­:
# - host: 'localhost'
# - user: 'root'
# - database: 'fishmarket_game'

# 4. å•Ÿå‹•ä¼ºæœå™¨
node server.js
```

---

### å‰ç«¯é©—è­‰

**æª¢æŸ¥éœæ…‹è³‡æº**:
```bash
# ç¢ºèª webroot ç›®éŒ„å­˜åœ¨
ls -la backend/webroot/

# æ‡‰è©²çœ‹åˆ°:
# - index.html
# - admin.html
# - login.html
# - public/css/app.css
# - public/js/common.js
```

**ç€è¦½å™¨æ¸¬è©¦**:
```
http://localhost:3000/              # é¦–é 
http://localhost:3000/admin.html    # ç®¡ç†å“¡
http://localhost:3000/login.html    # ç™»å…¥
http://localhost:3000/simple-team.html  # éšŠä¼
```

---

## ğŸ§ª åŠŸèƒ½æ¸¬è©¦

### æ¸¬è©¦ 1: å»ºç«‹éŠæˆ²

**API è«‹æ±‚**:
```bash
curl -X POST http://localhost:3000/api/admin/games/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "gameName": "æ¸¬è©¦éŠæˆ²",
    "numTeams": 10,
    "initialBudget": 1000000,
    "totalDays": 7
  }'
```

**é æœŸå›æ‡‰**:
```json
{
  "success": true,
  "gameId": 1,
  "message": "éŠæˆ²å‰µå»ºæˆåŠŸ"
}
```

**é©—è­‰è³‡æ–™åº«**:
```sql
SELECT id, name, status FROM games WHERE id = 1;
-- æ‡‰è©²çœ‹åˆ° status = 'pending'ï¼ˆä¸æ˜¯ 'finished'ï¼‰âœ…
```

---

### æ¸¬è©¦ 2: éšŠä¼åŠ å…¥ä¸¦è¨­å®šåç¨±

**API è«‹æ±‚**:
```bash
curl -X POST http://localhost:3000/api/game/1/join \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TEAM_TOKEN" \
  -d '{
    "teamId": 1,
    "customTeamName": "æµ·ç›œéšŠ"
  }'
```

**é©—è­‰è³‡æ–™åº«**:
```sql
SELECT team_names FROM games WHERE id = 1;
-- æ‡‰è©²çœ‹åˆ° {"1": "æµ·ç›œéšŠ"} âœ…
```

---

### æ¸¬è©¦ 3: æ¨é€²å¤©æ•¸

**API è«‹æ±‚**:
```bash
curl -X POST http://localhost:3000/api/admin/games/1/advance-day \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ADMIN_TOKEN"
```

**é©—è­‰è³‡æ–™åº«**:
```sql
SELECT game_id, day_number, status FROM game_days WHERE game_id = 1;
-- æ‡‰è©²çœ‹åˆ°æ¯å¤©éƒ½æœ‰è¨˜éŒ„ âœ…
```

---

### æ¸¬è©¦ 4: éŠæˆ²çµæŸ

**æ¨é€²åˆ°ç¬¬ 7 å¤©å¾Œ**:
```sql
SELECT id, name, status FROM games WHERE id = 1;
-- æ‡‰è©²çœ‹åˆ° status = 'completed'ï¼ˆä¸æ˜¯ 'finished'ï¼‰âœ…
```

---

## ğŸ› ï¸ ç–‘é›£æ’è§£

### å•é¡Œ 1: å»ºç«‹éŠæˆ²å¤±æ•— 500 éŒ¯èª¤

**ç—‡ç‹€**:
```
Error: Data truncated for column 'status' at row 1
```

**åŸå› **: status enum å€¼éŒ¯èª¤ï¼ˆä½¿ç”¨äº† 'finished' æˆ– 'paused'ï¼‰

**è§£æ±º**: âœ… **å·²ä¿®æ­£**ï¼Œç¢ºä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ server.js

---

### å•é¡Œ 2: team_names éŒ¯èª¤

**ç—‡ç‹€**:
```
Error: ER_BAD_FIELD_ERROR: Unknown column 'team_names' in 'field list'
```

**åŸå› **: è³‡æ–™åº«æœªåŸ·è¡Œé·ç§»

**è§£æ±º**:
```bash
mysql -u root -p fishmarket_game < migrations/001_add_team_names.sql
```

---

### å•é¡Œ 3: å‰ç«¯ 404 éŒ¯èª¤

**ç—‡ç‹€**:
```
Cannot GET /admin.html
```

**åŸå› **: webroot ç›®éŒ„ä¸å­˜åœ¨æˆ–é…ç½®éŒ¯èª¤

**è§£æ±º**:
```bash
# æª¢æŸ¥ webroot å­˜åœ¨
ls backend/webroot/

# å¦‚æœä¸å­˜åœ¨ï¼Œå¾é …ç›®æ ¹ç›®éŒ„è¤‡è£½
cp -r public backend/webroot/
cp *.html backend/webroot/
```

---

### å•é¡Œ 4: è³‡æ–™åº«é€£æ¥å¤±æ•—

**ç—‡ç‹€**:
```
Error: Access denied for user 'root'@'localhost'
```

**è§£æ±º**:
1. æª¢æŸ¥ MySQL æœå‹™æ˜¯å¦é‹è¡Œ
2. ç¢ºèªè³‡æ–™åº«ç”¨æˆ¶åå’Œå¯†ç¢¼
3. ä¿®æ”¹ server.js ä¸­çš„é€£æ¥è¨­å®šï¼ˆå¦‚éœ€è¦ï¼‰

---

## ğŸ“Š ç³»çµ±ç‹€æ…‹æª¢æŸ¥

### å¿«é€Ÿå¥åº·æª¢æŸ¥

```bash
# 1. æª¢æŸ¥è³‡æ–™åº«é€£æ¥
mysql -u root -p fishmarket_game -e "SELECT 1;"

# 2. æª¢æŸ¥ team_names æ¬„ä½
mysql -u root -p fishmarket_game -e "DESCRIBE games;" | grep team_names

# 3. æª¢æŸ¥ç„¡æ•ˆçš„ status å€¼
mysql -u root -p fishmarket_game -e "SELECT DISTINCT status FROM games;"
# æ‡‰åªçœ‹åˆ°: pending, active, completed

# 4. æª¢æŸ¥ä¼ºæœå™¨é‹è¡Œ
curl http://localhost:3000/api/health

# 5. æª¢æŸ¥å‰ç«¯è³‡æº
curl -I http://localhost:3000/admin.html
# æ‡‰è¿”å› 200 OK
```

---

## ğŸ”’ ç”Ÿç”¢ç’°å¢ƒå»ºè­°

### 1. ç’°å¢ƒè®Šæ•¸é…ç½®

å‰µå»º `.env` æª”æ¡ˆ:
```env
DB_HOST=localhost
DB_USER=fishmarket_user
DB_PASSWORD=secure_password
DB_NAME=fishmarket_game
PORT=3000
JWT_SECRET=your_secret_key_here
```

### 2. ä½¿ç”¨ PM2 ç®¡ç†é€²ç¨‹

```bash
# å®‰è£ PM2
npm install -g pm2

# å•Ÿå‹•æ‡‰ç”¨
pm2 start backend/server.js --name fishmarket-game

# è¨­å®šé–‹æ©Ÿå•Ÿå‹•
pm2 startup
pm2 save

# æŸ¥çœ‹ç‹€æ…‹
pm2 status

# æŸ¥çœ‹æ—¥èªŒ
pm2 logs fishmarket-game
```

### 3. Nginx åå‘ä»£ç†

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 4. è³‡æ–™åº«å‚™ä»½

```bash
# æ¯æ—¥å‚™ä»½è…³æœ¬
#!/bin/bash
DATE=$(date +%Y%m%d)
mysqldump -u root -p fishmarket_game > backup_$DATE.sql

# ä¿ç•™æœ€è¿‘ 7 å¤©çš„å‚™ä»½
find . -name "backup_*.sql" -mtime +7 -delete
```

---

## âœ… éƒ¨ç½²æª¢æŸ¥æ¸…å–®

éƒ¨ç½²å‰ç¢ºèª:

- [ ] MySQL æœå‹™é‹è¡Œä¸­
- [ ] è³‡æ–™åº« `fishmarket_game` å·²å‰µå»º
- [ ] team_names é·ç§»è…³æœ¬å·²åŸ·è¡Œ
- [ ] Node.js ä¾è³´å·²å®‰è£ (`npm install`)
- [ ] webroot ç›®éŒ„åŠæª”æ¡ˆå®Œæ•´
- [ ] è³‡æ–™åº«é€£æ¥è¨­å®šæ­£ç¢º

å•Ÿå‹•å¾Œç¢ºèª:

- [ ] ä¼ºæœå™¨å•Ÿå‹•ç„¡éŒ¯èª¤
- [ ] å¯è¨ªå• `/admin.html`
- [ ] å¯å‰µå»ºæ–°éŠæˆ²
- [ ] éšŠä¼å¯åŠ å…¥éŠæˆ²ä¸¦è¨­å®šåç¨±
- [ ] å¯æ¨é€²å¤©æ•¸
- [ ] éŠæˆ²å¯æ­£å¸¸çµæŸï¼ˆstatus = 'completed'ï¼‰

---

## ğŸ“ ç²å–å¹«åŠ©

### æª¢æŸ¥æ—¥èªŒ

```bash
# ä¼ºæœå™¨æ—¥èªŒ
tail -f backend/logs/server.log

# PM2 æ—¥èªŒ
pm2 logs fishmarket-game

# MySQL éŒ¯èª¤æ—¥èªŒ
tail -f /var/log/mysql/error.log
```

### å¸¸ç”¨ SQL æŸ¥è©¢

```sql
-- æŸ¥çœ‹æ‰€æœ‰éŠæˆ²
SELECT id, name, status, current_day, total_days FROM games;

-- æŸ¥çœ‹éŠæˆ²åƒèˆ‡è€…
SELECT gp.*, u.username, u.team_name
FROM game_participants gp
JOIN users u ON gp.team_id = u.id
WHERE gp.game_id = 1;

-- æŸ¥çœ‹æ¯æ—¥è³‡æ–™
SELECT * FROM game_days WHERE game_id = 1 ORDER BY day_number;

-- æŸ¥çœ‹äº¤æ˜“è¨˜éŒ„
SELECT * FROM transactions WHERE game_id = 1 ORDER BY created_at DESC LIMIT 20;
```

---

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

ç³»çµ±ç¾åœ¨å·²å°±ç·’ï¼Œæ‰€æœ‰åŠŸèƒ½æ€§å•é¡Œå·²ä¿®æ­£:

âœ… games.status enum å€¼æ­£ç¢ºï¼ˆcompleted å–ä»£ finishedï¼‰
âœ… team_names æ¬„ä½æ”¯æ´ï¼ˆéœ€åŸ·è¡Œé·ç§»ï¼‰
âœ… æ—¥æµç¨‹æ¨é€²é‚è¼¯å®Œæ•´
âœ… å‰ç«¯éœæ…‹è³‡æºå®Œæ•´

é–‹å§‹äº«å—æ‚¨çš„é­šå¸‚å ´éŠæˆ²ï¼

---

**æ–‡æª”ç‰ˆæœ¬**: 1.0
**æœ€å¾Œæ›´æ–°**: 2025-01-18
**ç¶­è­·è€…**: Claude Code
